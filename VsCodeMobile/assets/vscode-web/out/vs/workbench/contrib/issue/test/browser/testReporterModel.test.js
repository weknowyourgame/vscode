/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import assert from 'assert';
import { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';
import { IssueReporterModel } from '../../browser/issueReporterModel.js';
import { normalizeGitHubUrl } from '../../common/issueReporterUtil.js';
suite('IssueReporter', () => {
    ensureNoDisposablesAreLeakedInTestSuite();
    test('sets defaults to include all data', () => {
        const issueReporterModel = new IssueReporterModel();
        assert.deepStrictEqual(issueReporterModel.getData(), {
            allExtensions: [],
            includeSystemInfo: true,
            includeExtensionData: true,
            includeWorkspaceInfo: true,
            includeProcessInfo: true,
            includeExtensions: true,
            includeExperiments: true,
            issueType: 0
        });
    });
    test('serializes model skeleton when no data is provided', () => {
        const issueReporterModel = new IssueReporterModel({});
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes GPU information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    'checker_imaging': 'disabled_off'
                }
            }
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes experiment info when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    'checker_imaging': 'disabled_off'
                }
            },
            experimentInfo: 'vsliv695:30137379\nvsins829:30139715'
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
</details>Extensions: none<details>
<summary>A/B Experiments</summary>

\`\`\`
vsliv695:30137379
vsins829:30139715
\`\`\`

</details>

<!-- generated by issue reporter -->`);
    });
    test('serializes Linux environment information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {},
                linuxEnv: {
                    desktopSession: 'ubuntu',
                    xdgCurrentDesktop: 'ubuntu',
                    xdgSessionDesktop: 'ubuntu:GNOME',
                    xdgSessionType: 'x11'
                }
            }
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status||
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
|DESKTOP_SESSION|ubuntu|
|XDG_CURRENT_DESKTOP|ubuntu|
|XDG_SESSION_DESKTOP|ubuntu:GNOME|
|XDG_SESSION_TYPE|x11|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes remote information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    'checker_imaging': 'disabled_off'
                },
                remoteData: [
                    {
                        hostName: 'SSH: Pineapple',
                        machineInfo: {
                            os: 'Linux x64 4.18.0',
                            cpus: 'Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz (2 x 2294)',
                            memory: '8GB',
                            vmHint: '100%'
                        }
                    }
                ]
            }
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:
Remote OS version: Linux x64 4.18.0

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|

|Item|Value|
|---|---|
|Remote|SSH: Pineapple|
|OS|Linux x64 4.18.0|
|CPUs|Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz (2 x 2294)|
|Memory (System)|8GB|
|VM|100%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('escapes backslashes in processArgs', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '\\\\HOST\\path',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {}
            }
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status||
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv|\\\\\\\\HOST\\\\path|
|Screen Reader|no|
|VM|0%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('should supply mode if applicable', () => {
        const issueReporterModel = new IssueReporterModel({
            isUnsupported: true,
            restrictedMode: true
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes: Restricted, Unsupported

Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('should normalize GitHub urls', () => {
        [
            'https://github.com/repo',
            'https://github.com/repo/',
            'https://github.com/repo.git',
            'https://github.com/repo/issues',
            'https://github.com/repo/issues/',
            'https://github.com/repo/issues/new',
            'https://github.com/repo/issues/new/'
        ].forEach(url => {
            assert.strictEqual('https://github.com/repo', normalizeGitHubUrl(url));
        });
    });
    test('should have support for filing on extensions for bugs, performance issues, and feature requests', () => {
        [
            0 /* IssueType.Bug */,
            2 /* IssueType.FeatureRequest */,
            1 /* IssueType.PerformanceIssue */
        ].forEach(type => {
            const issueReporterModel = new IssueReporterModel({
                issueType: type,
                fileOnExtension: true
            });
            assert.strictEqual(issueReporterModel.fileOnExtension(), true);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdFJlcG9ydGVyTW9kZWwudGVzdC5qcyIsInNvdXJjZVJvb3QiOiJmaWxlOi8vL2hvbWUvZnJvc3R5L3ZzY29kZS9zcmMvIiwic291cmNlcyI6WyJ2cy93b3JrYmVuY2gvY29udHJpYi9pc3N1ZS90ZXN0L2Jyb3dzZXIvdGVzdFJlcG9ydGVyTW9kZWwudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O2dHQUdnRztBQUVoRyxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUFFLHVDQUF1QyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDbkcsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFFekUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFFdkUsS0FBSyxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDM0IsdUNBQXVDLEVBQUUsQ0FBQztJQUMxQyxJQUFJLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1FBQzlDLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDcEQsYUFBYSxFQUFFLEVBQUU7WUFDakIsaUJBQWlCLEVBQUUsSUFBSTtZQUN2QixvQkFBb0IsRUFBRSxJQUFJO1lBQzFCLG9CQUFvQixFQUFFLElBQUk7WUFDMUIsa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLGtCQUFrQixFQUFFLElBQUk7WUFDeEIsU0FBUyxFQUFFLENBQUM7U0FDWixDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxvREFBb0QsRUFBRSxHQUFHLEVBQUU7UUFDL0QsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxXQUFX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