<!DOCTYPE html>
<html>
<head>
	<script>
		if (performance && performance.mark) {
			performance.mark('code/didStartRenderer');
		}
	</script>
	<meta charset="utf-8" />

	<!-- Mobile tweaks -->
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-title" content="VS Code">

	<!-- Disable pinch zooming -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">

	<title>VS Code Web</title>

	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #1e1e1e;
		}
		#vscode-loading {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: #cccccc;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			text-align: center;
		}
		#vscode-loading .spinner {
			width: 40px;
			height: 40px;
			border: 4px solid #333;
			border-top-color: #cccccc;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}
		@keyframes spin {
			to { transform: rotate(360deg); }
		}
	</style>

	<!-- Workbench Configuration (empty for now) -->
	<meta id="vscode-workbench-web-configuration" data-settings="{}">

	<!-- Workbench Auth Session -->
	<meta id="vscode-workbench-auth-session" data-settings="{}">

	<!-- Load Codicon font for icons -->
	<link rel="stylesheet" href="out/vs/base/browser/ui/codicons/codicon/codicon.css">

</head>

<body aria-label="">
	<div id="vscode-loading">
		<div class="spinner"></div>
		<div>Loading VS Code...</div>
	</div>
</body>

<!-- Startup (do not modify order of script tags!) -->
<script>
	// Calculate base URL dynamically
	const getBaseUrl = () => {
		const currentPath = window.location.pathname;
		// Remove index.html and get the directory
		// For /vscode-web/index.html, this gives us /vscode-web/
		const basePath = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
		return basePath.endsWith('/') ? basePath : basePath + '/';
	};

	const baseUrl = getBaseUrl();
	console.log('VS Code Web Base URL:', baseUrl);
	console.log('Current location:', window.location.href);

	// Set the global file root for VS Code (points to out directory)
	globalThis._VSCODE_FILE_ROOT = baseUrl + 'out/';
	console.log('_VSCODE_FILE_ROOT:', globalThis._VSCODE_FILE_ROOT);
</script>
<script>
	if (performance && performance.mark) {
		performance.mark('code/willLoadWorkbenchMain');
	}
</script>

<!-- Load VS Code workbench as ES module -->
<script type="module">
	// Import workbench
	try {
		console.log('Loading workbench from:', globalThis._VSCODE_FILE_ROOT + '../out/vs/code/browser/workbench/workbench.js');

		// Import the workbench module
		const workbenchUrl = new URL('out/vs/code/browser/workbench/workbench.js', window.location.href);
		console.log('Workbench URL:', workbenchUrl.toString());

		await import(workbenchUrl.toString());

		console.log('VS Code Web loaded successfully');

		// Remove loading indicator
		const loading = document.getElementById('vscode-loading');
		if (loading) {
			loading.remove();
		}
	} catch (error) {
		console.error('Failed to load VS Code Web:', error);
		console.error('Error stack:', error.stack);

		const loading = document.getElementById('vscode-loading');
		if (loading) {
			loading.querySelector('.spinner').remove();
			loading.innerHTML += '<div style="color: #f48771; margin-top: 20px;">Failed to load VS Code</div>';
			loading.innerHTML += `<div style="color: #999; font-size: 12px; margin-top: 10px;">${error.message}</div>`;
		}
	}
</script>

</html>
